{
  "id": "00000000-0000-0000-0000-000000000005",
  "revision": 0,
  "last_node_id": 15,
  "last_link_id": 14,
  "nodes": [
    {
      "id": 1,
      "type": "VHS_LoadImagesPath",
      "pos": [
        100,
        350
      ],
      "size": [
        320,
        200
      ],
      "flags": {},
      "order": 0,
      "mode": 0,
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            1,
            14
          ],
          "slot_index": 0
        },
        {
          "name": "MASK",
          "type": "MASK",
          "links": null,
          "slot_index": 1
        },
        {
          "name": "frame_count",
          "type": "INT",
          "links": null,
          "slot_index": 2
        }
      ],
      "properties": {
        "Node name for S&R": "VHS_LoadImagesPath"
      },
      "widgets_values": [
        "projects/MONK0001_pl01_ref_v001/source/frames",
        0,
        0,
        1,
        "Disabled",
        1920,
        1080,
        null,
        null
      ],
      "title": "\ud83d\udcc1 Load Source Frames"
    },
    {
      "id": 2,
      "type": "LoadSAM3Model",
      "pos": [
        100,
        620
      ],
      "size": [
        320,
        80
      ],
      "flags": {},
      "order": 1,
      "mode": 0,
      "outputs": [
        {
          "name": "SAM3_MODEL",
          "type": "SAM3_MODEL",
          "links": [
            2
          ],
          "slot_index": 0
        }
      ],
      "properties": {
        "Node name for S&R": "LoadSAM3Model"
      },
      "widgets_values": [
        "sam3.pt"
      ],
      "title": "\ud83e\udde0 Load SAM3 Model"
    },
    {
      "id": 14,
      "type": "VHS_SelectEveryNthImage",
      "pos": [
        550,
        350
      ],
      "size": [
        300,
        120
      ],
      "flags": {},
      "order": 2,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 14
        }
      ],
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            10
          ],
          "slot_index": 0
        },
        {
          "name": "count",
          "type": "INT",
          "links": null,
          "slot_index": 1
        }
      ],
      "properties": {
        "Node name for S&R": "VHS_SelectEveryNthImage"
      },
      "widgets_values": [
        9999,
        0
      ],
      "title": "\ud83c\udfac Select Frame (skip_first = frame number)"
    },
    {
      "id": 10,
      "type": "SAM3PointCollector",
      "pos": [
        550,
        540
      ],
      "size": [
        450,
        400
      ],
      "flags": {},
      "order": 3,
      "mode": 0,
      "inputs": [
        {
          "name": "image",
          "type": "IMAGE",
          "link": 10
        }
      ],
      "outputs": [
        {
          "name": "positive_points",
          "type": "SAM3_POINTS_PROMPT",
          "links": [
            12
          ],
          "slot_index": 0
        },
        {
          "name": "negative_points",
          "type": "SAM3_POINTS_PROMPT",
          "links": [
            13
          ],
          "slot_index": 1
        }
      ],
      "properties": {
        "Node name for S&R": "SAM3PointCollector"
      },
      "widgets_values": [
        "{}",
        "[]",
        "[]"
      ],
      "title": "\ud83c\udfaf Interactive Selector (click points here)"
    },
    {
      "id": 3,
      "type": "SAM3VideoSegmentation",
      "pos": [
        550,
        1010
      ],
      "size": [
        380,
        180
      ],
      "flags": {},
      "order": 4,
      "mode": 0,
      "inputs": [
        {
          "name": "video_frames",
          "type": "IMAGE",
          "link": 1
        },
        {
          "name": "positive_points",
          "type": "SAM3_POINTS_PROMPT",
          "link": 12
        },
        {
          "name": "negative_points",
          "type": "SAM3_POINTS_PROMPT",
          "link": 13
        }
      ],
      "outputs": [
        {
          "name": "video_state",
          "type": "SAM3_VIDEO_STATE",
          "links": [
            3,
            5
          ],
          "slot_index": 0
        }
      ],
      "properties": {
        "Node name for S&R": "SAM3VideoSegmentation"
      },
      "widgets_values": [
        "point",
        "",
        0,
        0.3
      ],
      "title": "\ud83c\udfac Video Segmentation (set frame_idx to match!)"
    },
    {
      "id": 4,
      "type": "SAM3Propagate",
      "pos": [
        1100,
        600
      ],
      "size": [
        350,
        150
      ],
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [
        {
          "name": "sam3_model",
          "type": "SAM3_MODEL",
          "link": 2
        },
        {
          "name": "video_state",
          "type": "SAM3_VIDEO_STATE",
          "link": 3
        }
      ],
      "outputs": [
        {
          "name": "masks",
          "type": "SAM3_VIDEO_MASKS",
          "links": [
            4
          ],
          "slot_index": 0
        },
        {
          "name": "scores",
          "type": "SAM3_VIDEO_SCORES",
          "links": null,
          "slot_index": 1
        },
        {
          "name": "video_state",
          "type": "SAM3_VIDEO_STATE",
          "links": null,
          "slot_index": 2
        }
      ],
      "properties": {
        "Node name for S&R": "SAM3Propagate"
      },
      "widgets_values": [
        0,
        -1,
        "bidirectional",
        false
      ],
      "title": "\ud83d\udd04 Propagate Through Video"
    },
    {
      "id": 5,
      "type": "SAM3VideoOutput",
      "pos": [
        1600,
        500
      ],
      "size": [
        350,
        150
      ],
      "flags": {},
      "order": 6,
      "mode": 0,
      "inputs": [
        {
          "name": "masks",
          "type": "SAM3_VIDEO_MASKS",
          "link": 4
        },
        {
          "name": "video_state",
          "type": "SAM3_VIDEO_STATE",
          "link": 5
        }
      ],
      "outputs": [
        {
          "name": "masks",
          "type": "MASK",
          "links": [
            6
          ],
          "slot_index": 0
        },
        {
          "name": "frames",
          "type": "IMAGE",
          "links": null,
          "slot_index": 1
        },
        {
          "name": "visualization",
          "type": "IMAGE",
          "links": [
            8
          ],
          "slot_index": 2
        }
      ],
      "properties": {
        "Node name for S&R": "SAM3VideoOutput"
      },
      "widgets_values": [
        -1,
        true
      ],
      "title": "\ud83d\udce4 Extract Masks (all objects)"
    },
    {
      "id": 6,
      "type": "MaskToImage",
      "pos": [
        1600,
        720
      ],
      "size": [
        220,
        60
      ],
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [
        {
          "name": "mask",
          "type": "MASK",
          "link": 6
        }
      ],
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "links": [
            7,
            9
          ],
          "slot_index": 0
        }
      ],
      "properties": {
        "Node name for S&R": "MaskToImage"
      },
      "title": "\ud83d\udd04 Mask \u2192 Image"
    },
    {
      "id": 7,
      "type": "SaveImage",
      "pos": [
        2100,
        350
      ],
      "size": [
        350,
        300
      ],
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 7
        }
      ],
      "properties": {},
      "widgets_values": [
        "projects/MONK0001_pl01_ref_v001/roto/custom/mask"
      ],
      "title": "\ud83d\udcbe Save Masks"
    },
    {
      "id": 8,
      "type": "PreviewImage",
      "pos": [
        2100,
        720
      ],
      "size": [
        350,
        300
      ],
      "flags": {},
      "order": 9,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 8
        }
      ],
      "properties": {},
      "title": "\ud83d\udc41\ufe0f Preview Visualization"
    },
    {
      "id": 9,
      "type": "PreviewImage",
      "pos": [
        1600,
        850
      ],
      "size": [
        280,
        220
      ],
      "flags": {},
      "order": 10,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 9
        }
      ],
      "properties": {},
      "title": "\ud83d\udc41\ufe0f Preview Masks"
    },
    {
      "id": 12,
      "type": "Note",
      "pos": [
        100,
        50
      ],
      "size": [
        400,
        240
      ],
      "flags": {},
      "order": 11,
      "mode": 0,
      "properties": {
        "text": ""
      },
      "widgets_values": [
        "\ud83d\udccb INTERACTIVE SEGMENTATION\n\nFor complex shots requiring manual selection:\n\n1. In 'Select Frame' node, set skip_first_images\n   to the frame number you want (0 = first frame)\n2. IMPORTANT: Set the same frame number in\n   'Video Segmentation' node (frame_idx)\n3. Click points in the 'Interactive Selector' node\n   - Left click = positive (include)\n   - Shift+Left or Right click = negative (exclude)\n4. Click 'Queue Prompt' to run\n5. Masks save to roto/custom/\n\nRequires: ComfyUI-SAM3, ComfyUI-VideoHelperSuite"
      ],
      "title": "\ud83d\udccb Instructions",
      "color": "#332",
      "bgcolor": "#553"
    },
    {
      "id": 13,
      "type": "Note",
      "pos": [
        1100,
        350
      ],
      "size": [
        350,
        180
      ],
      "flags": {},
      "order": 12,
      "mode": 0,
      "properties": {
        "text": ""
      },
      "widgets_values": [
        "\ud83d\udca1 TIPS\n\n\u2022 Frame numbers are 0-indexed (first frame = 0)\n\u2022 Use bidirectional propagation to go\n  forwards and backwards from your frame\n\u2022 Click once on each object you want\n\u2022 Use negative points to exclude nearby objects"
      ],
      "title": "\ud83d\udca1 Tips",
      "color": "#234",
      "bgcolor": "#456"
    }
  ],
  "links": [
    [
      1,
      1,
      0,
      3,
      0,
      "IMAGE"
    ],
    [
      2,
      2,
      0,
      4,
      0,
      "SAM3_MODEL"
    ],
    [
      3,
      3,
      0,
      4,
      1,
      "SAM3_VIDEO_STATE"
    ],
    [
      4,
      4,
      0,
      5,
      0,
      "SAM3_VIDEO_MASKS"
    ],
    [
      5,
      3,
      0,
      5,
      1,
      "SAM3_VIDEO_STATE"
    ],
    [
      6,
      5,
      0,
      6,
      0,
      "MASK"
    ],
    [
      7,
      6,
      0,
      7,
      0,
      "IMAGE"
    ],
    [
      8,
      5,
      2,
      8,
      0,
      "IMAGE"
    ],
    [
      9,
      6,
      0,
      9,
      0,
      "IMAGE"
    ],
    [
      10,
      14,
      0,
      10,
      0,
      "IMAGE"
    ],
    [
      12,
      10,
      0,
      3,
      1,
      "SAM3_POINTS_PROMPT"
    ],
    [
      13,
      10,
      1,
      3,
      2,
      "SAM3_POINTS_PROMPT"
    ],
    [
      14,
      1,
      0,
      14,
      0,
      "IMAGE"
    ]
  ],
  "groups": [
    {
      "title": "\ud83d\udce5 INPUT",
      "bounding": [
        80,
        320,
        400,
        420
      ],
      "color": "#3f789e"
    },
    {
      "title": "\ud83c\udfaf SELECT (Interactive)",
      "bounding": [
        530,
        320,
        480,
        920
      ],
      "color": "#9e8f3e"
    },
    {
      "title": "\ud83d\udd04 PROPAGATE",
      "bounding": [
        1080,
        320,
        400,
        480
      ],
      "color": "#8f3e9e"
    },
    {
      "title": "\ud83d\udcbe OUTPUT",
      "bounding": [
        1580,
        320,
        500,
        800
      ],
      "color": "#3e9e5f"
    },
    {
      "title": "\ud83d\udcbe SAVE",
      "bounding": [
        2080,
        320,
        400,
        740
      ],
      "color": "#5e9e3f"
    }
  ],
  "config": {},
  "extra": {
    "ds": {
      "scale": 0.6,
      "offset": [
        0,
        0
      ]
    },
    "info": {
      "name": "VFX Pipeline - Interactive Segmentation",
      "author": "VFX Pipeline",
      "description": "SAM3 point-prompt video segmentation for manual selection",
      "requires": [
        "ComfyUI-SAM3",
        "ComfyUI-VideoHelperSuite"
      ]
    }
  },
  "version": 0.4
}