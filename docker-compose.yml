services:
  vfx-ingest:
    build: .
    image: vfx-ingest:latest
    container_name: vfx-ingest
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - START_COMFYUI=true
      - VFX_MODELS_DIR=/models
      - VFX_PROJECTS_DIR=/workspace/projects
    volumes:
      # Model storage (read-only for safety)
      # Default: <repo>/.vfx_pipeline/models (set by run_docker.sh)
      - ${VFX_MODELS_DIR:-./.vfx_pipeline/models}:/models:ro
      # Project workspace (read-write)
      # Default: <repo>/../vfx_projects (set by run_docker.sh)
      - ${VFX_PROJECTS_DIR:-../vfx_projects}:/workspace/projects
    ports:
      - "8188:8188"  # ComfyUI web interface
    stdin_open: true
    tty: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
